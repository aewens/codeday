// Generated by CoffeeScript 1.7.1
(function() {
  define(["keys", "store", "mods/rgx"], function(Keys, Store, Rgx) {
    return {
      commands: {
        newline: function(enter, e, edit) {
          if (!(enter === Keys.enter && !$("#dialog").is(":visible"))) {
            return;
          }
          return edit.line();
        },
        savefile: function(s, e, edit) {
          if (!(Keys.pressed[Keys.ctrl] && s === Keys.s)) {
            return;
          }
          e.preventDefault();
          return $("#dialog").show().focus().attr("placeholder", "File name...").on("keyup", function(e) {
            var store;
            if (e.keyCode === Keys.enter) {
              store = new Store($("#dialog"), $("textarea"), $("#files"), $("#info"), $("#save"));
              store.saveFile($("#dialog").val(), $("textarea").val());
              store.listFiles();
              return $(this).val("").hide();
            } else if (e.keyCode === Keys.esc) {
              $(this).val("").hide();
              return $("textarea").focus();
            }
          });
        }
      },
      run: function(key, e, edit) {
        var cmd, _results;
        _results = [];
        for (cmd in this.commands) {
          _results.push(this.commands[cmd](key, e, edit));
        }
        return _results;
      }
    };
  });

}).call(this);
